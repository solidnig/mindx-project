<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Thêm công thức</title>
    <style>
      body {
        font-family: Arial;
        padding: 20px;
      }
      input,
      textarea {
        width: 100%;
        padding: 8px;
        margin: 5px 0;
      }
      .row {
        margin-bottom: 10px;
      }
      button {
        padding: 10px 16px;
        background: #e67e22;
        color: white;
        border: none;
        cursor: pointer;
        margin-top: 10px;
      }
      .sub-btn {
        background: #3498db;
        margin-left: 5px;
        display: block;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Thêm công thức</h1>

    <h2>Tên món:</h2>
    <input id="ten" />

    <h2>Ghi chú:</h2>
    <input id="ghi_chu" />

    <!-- NGUYÊN LIỆU -->
    <h2>Nguyên liệu</h2>
    <div id="nguyenLieuList"></div>
    <button class="sub-btn" onclick="addIngredient()">
      + Thêm nguyên liệu
    </button>

    <!-- CÁCH LÀM -->
    <h2>Các bước làm</h2>
    <div id="cachLamList"></div>
    <button class="sub-btn" onclick="addStep()">+ Thêm bước</button>

    <h2>Mẹo (tip):</h2>
    <input id="tip" />

    <button onclick="saveRecipe()">Lưu công thức</button>

    <script>
      // ============ THÊM NGUYÊN LIỆU ============
      function addIngredient() {
        const div = document.createElement("div");
        div.className = "row";
        div.innerHTML = `<input class="nl" placeholder="Nhập nguyên liệu...">`;
        document.getElementById("nguyenLieuList").appendChild(div);
      }

      // ============ THÊM BƯỚC ============
      function addStep() {
        const div = document.createElement("div");
        div.className = "row";
        div.innerHTML = `
        <input class="step-title" placeholder="Tiêu đề bước (VD: Bước 1...)">
        <textarea class="step-desc" placeholder="Mô tả chi tiết của bước"></textarea>
    `;
        document.getElementById("cachLamList").appendChild(div);
      }

      // ============ LƯU CÔNG THỨC ============
      function saveRecipe() {
        // LẤY DỮ LIỆU CƠ BẢN
        const ten = document.getElementById("ten").value;
        const ghi_chu = document.getElementById("ghi_chu").value;
        const tip_raw = document.getElementById("tip").value;
        const tip = tip_raw === "" ? null : tip_raw;

        // LẤY NGUYÊN LIỆU
        const nguyen_lieu = [...document.querySelectorAll(".nl")]
          .map((input) => input.value)
          .filter((x) => x.trim() !== "");

        // LẤY CÁC BƯỚC LÀM
        const stepTitles = document.querySelectorAll(".step-title");
        const stepDescs = document.querySelectorAll(".step-desc");

        const cach_lam = [];
        for (let i = 0; i < stepTitles.length; i++) {
          if (stepTitles[i].value.trim() !== "") {
            cach_lam.push({
              tieu_de: stepTitles[i].value,
              mo_ta: stepDescs[i].value,
            });
          }
        }

        // TẠO OBJECT CÔNG THỨC
        const recipe = {
          ten,
          ghi_chu,
          nguyen_lieu,
          cach_lam,
          tip,
        };

        // LẤY LIST TỪ LOCALSTORAGE
        let list = JSON.parse(localStorage.getItem("recipes")) || [];

        // ĐẨY VÀO MẢNG
        list.push(recipe);

        // LƯU LẠI
        localStorage.setItem("recipes", JSON.stringify(list));

        alert("Đã lưu công thức thành công!");
      }
    </script>
  </body>
</html>
